# Install Policy Configuration
# Per Plane-Aware Package System design
#
# This policy defines allowed tiers, actions, and requirements
# for package installation operations per environment and plane.

schema_version: "1.0"
policy_id: POL-INSTALL-DEFAULT
policy_type: install
name: Default Install Policy
description: Rules governing package installation, uninstallation, and verification across planes
version: "1.0.0"
effective_date: "2026-01-01T00:00:00Z"

applies_to:
  planes:
    - all
  tiers:
    - all
  environments:
    - all

rules:
  # R001: G0 (Genesis) packages require admin role
  - rule_id: R001
    description: Genesis packages can only be installed by admins
    condition:
      action: install
      tier: G0
    effect: allow
    requirements:
      - signature
      - attestation
      - approval
      - audit_log
    priority: 1000
    allowed_roles:
      - admin

  # R002: HOT plane requires admin for all writes
  - rule_id: R002
    description: HOT plane modifications require admin privileges
    condition:
      action: "*"
      plane: hot
    effect: allow
    requirements:
      - signature
      - attestation
      - audit_log
    priority: 950
    allowed_roles:
      - admin

  # R003: Production requires signature and attestation
  - rule_id: R003
    description: Production environment requires signed and attested packages
    condition:
      action: install
      environment: prod
    effect: allow
    requirements:
      - signature
      - attestation
      - integrity_check
      - audit_log
    priority: 900

  # R004: Staging requires at least attestation
  - rule_id: R004
    description: Staging environment requires attested packages
    condition:
      action: install
      environment: staging
    effect: allow
    requirements:
      - attestation
      - audit_log
    priority: 800

  # R005: Dev environment has relaxed requirements
  - rule_id: R005
    description: Development environment allows unsigned packages with waiver
    condition:
      action: install
      environment: dev
    effect: allow
    requirements:
      - audit_log
    priority: 100
    allow_waivers:
      - signature
      - attestation

  # R006: Uninstall requires same privileges as install
  - rule_id: R006
    description: Uninstall operations follow install privilege rules
    condition:
      action: uninstall
    effect: allow
    requirements:
      - audit_log
    priority: 700

  # R007: Verify is always allowed for auditors
  - rule_id: R007
    description: Verification operations allowed for auditors
    condition:
      action: verify
    effect: allow
    priority: 500
    allowed_roles:
      - admin
      - maintainer
      - auditor
      - reader

  # R008: Recovery requires admin
  - rule_id: R008
    description: Recovery operations require admin privileges
    condition:
      action: recover
    effect: allow
    requirements:
      - approval
      - audit_log
    priority: 850
    allowed_roles:
      - admin

  # R009: Doctor fix requires admin or maintainer
  - rule_id: R009
    description: Automated fix operations require elevated privileges
    condition:
      action: doctor_fix
    effect: allow
    requirements:
      - audit_log
    priority: 800
    allowed_roles:
      - admin
      - maintainer

  # R010: Pack operations allowed for maintainers
  - rule_id: R010
    description: Package creation allowed for maintainers
    condition:
      action: pack
    effect: allow
    requirements:
      - audit_log
    priority: 600
    allowed_roles:
      - admin
      - maintainer

  # R011: Sign operations require signing key
  - rule_id: R011
    description: Signing requires CONTROL_PLANE_SIGNING_KEY
    condition:
      action: sign
    effect: allow
    requirements:
      - audit_log
    priority: 700
    allowed_roles:
      - admin
      - maintainer

# Plane-specific restrictions
plane_restrictions:
  hot:
    # HOT plane: most restrictive
    allowed_tiers:
      - G0
      - T0
    required_for_all:
      - signature
      - attestation
      - approval
    min_role: admin

  first:
    # FIRST_ORDER: moderate restrictions
    allowed_tiers:
      - G0
      - T0
      - T1
      - T2
    required_for_all:
      - attestation
    min_role: maintainer

  second:
    # SECOND_ORDER: least restrictive
    allowed_tiers:
      - G0
      - T0
      - T1
      - T2
      - T3
    required_for_all: []
    min_role: maintainer

# Environment-specific overrides
environment_overrides:
  prod:
    strict_mode: true
    require_approval_for:
      - G0
      - T0
    block_waivers: true

  staging:
    strict_mode: false
    require_approval_for:
      - G0
    block_waivers: false

  dev:
    strict_mode: false
    require_approval_for: []
    block_waivers: false
    allow_passthrough_auth: true

# Exceptions (empty by default)
exceptions: []

metadata:
  author: system
  approved_at: "2026-01-01T00:00:00Z"
  review_date: "2027-01-01"
  tags:
    - install
    - security
    - default
