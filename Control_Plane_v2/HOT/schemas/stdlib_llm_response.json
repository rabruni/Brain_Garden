{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "stdlib_llm_response.json",
  "title": "LLM Stdlib Response",
  "description": "Response schema for the LLM Standard Library CLI",
  "type": "object",
  "properties": {
    "status": {
      "type": "string",
      "enum": ["ok", "error"],
      "description": "Operation status"
    },
    "result": {
      "description": "Operation result (present on success)",
      "oneOf": [
        {
          "description": "complete result",
          "type": "object",
          "properties": {
            "content": {
              "type": "string",
              "description": "LLM response content"
            },
            "model": {
              "type": "string",
              "description": "Model used for completion"
            },
            "usage": {
              "type": "object",
              "description": "Token usage",
              "properties": {
                "input_tokens": { "type": "integer" },
                "output_tokens": { "type": "integer" }
              },
              "required": ["input_tokens", "output_tokens"]
            },
            "request_id": {
              "type": "string",
              "description": "Provider request ID"
            },
            "cached": {
              "type": "boolean",
              "description": "Whether response was cached"
            },
            "prompt_pack_id": {
              "type": "string",
              "description": "Governed prompt reference"
            },
            "provider_id": {
              "type": "string",
              "description": "Provider used"
            }
          },
          "required": ["content", "model", "usage", "request_id", "prompt_pack_id", "provider_id"]
        },
        {
          "description": "load_prompt result",
          "type": "object",
          "properties": {
            "prompt_pack_id": {
              "type": "string",
              "description": "Prompt pack identifier"
            },
            "content": {
              "type": "string",
              "description": "Prompt template content"
            },
            "hash": {
              "type": "string",
              "description": "SHA256 hash of content"
            }
          },
          "required": ["prompt_pack_id", "content", "hash"]
        },
        {
          "description": "list_providers result",
          "type": "object",
          "properties": {
            "providers": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Available provider IDs"
            }
          },
          "required": ["providers"]
        }
      ]
    },
    "error": {
      "type": "object",
      "description": "Error details (present on error)",
      "properties": {
        "code": {
          "type": "string",
          "description": "Error code"
        },
        "message": {
          "type": "string",
          "description": "Human-readable error message"
        },
        "details": {
          "description": "Additional error details"
        }
      },
      "required": ["code", "message"]
    },
    "evidence": {
      "type": "object",
      "description": "Evidence envelope for this operation",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO8601 timestamp"
        },
        "duration_ms": {
          "type": "integer",
          "description": "Execution duration in milliseconds"
        },
        "llm_call": {
          "type": "object",
          "description": "LLM-specific evidence (never includes raw content)",
          "properties": {
            "provider_id": { "type": "string" },
            "model": { "type": "string" },
            "request_id": { "type": "string" },
            "usage": {
              "type": "object",
              "properties": {
                "input_tokens": { "type": "integer" },
                "output_tokens": { "type": "integer" }
              }
            },
            "prompt_pack_id": { "type": "string" },
            "prompt_hash": { "type": "string" },
            "response_hash": { "type": "string" },
            "cached": { "type": "boolean" },
            "api_key_fingerprint": { "type": "string" }
          },
          "required": ["provider_id", "model", "request_id", "prompt_pack_id", "prompt_hash", "response_hash"]
        }
      },
      "required": ["timestamp"]
    }
  },
  "required": ["status"]
}
