{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://control-plane.local/schemas/framework.schema.json",
  "title": "Framework Schema",
  "description": "Schema for Control Plane Framework definitions - the highest governance layer",
  "type": "object",
  "required": [
    "framework_id",
    "title",
    "status",
    "version"
  ],
  "properties": {
    "framework_id": {
      "type": "string",
      "pattern": "^FMWK-[A-Z0-9-]+$",
      "description": "Unique framework identifier"
    },
    "title": {
      "type": "string",
      "maxLength": 200,
      "description": "Human-readable framework title"
    },
    "status": {
      "type": "string",
      "enum": ["active", "draft", "deprecated"],
      "description": "Current framework status"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version"
    },
    "ring": {
      "type": "string",
      "enum": ["kernel", "admin", "resident"],
      "description": "Ring this framework operates in (kernel=foundation, admin=observer, resident=worker)"
    },
    "plane": {
      "type": "string",
      "enum": ["ho3", "ho2", "ho1", "hot"],
      "description": "Primary plane this framework governs"
    },
    "plane_id": {
      "type": "string",
      "enum": ["hot", "ho3", "ho2", "ho1"],
      "description": "Primary plane this framework governs (alias for plane)"
    },
    "expected_specs": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^SPEC-[A-Z0-9-]+$"
      },
      "description": "Specs that MUST exist and reference this framework (wiring diagram)"
    },
    "created_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of framework creation"
    },
    "assets": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Framework documentation files"
    },
    "previous_id": {
      "type": "string",
      "description": "ID of previous version of this framework"
    },
    "invariants": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["level", "statement"],
        "properties": {
          "level": {
            "type": "string",
            "enum": ["MUST", "MUST NOT", "SHOULD", "SHOULD NOT", "MAY"],
            "description": "RFC 2119 requirement level"
          },
          "statement": {
            "type": "string",
            "description": "The invariant statement"
          }
        }
      },
      "description": "Framework invariants that MUST be enforced"
    },
    "path_authorizations": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Glob patterns for paths specs under this framework MAY own"
    },
    "required_gates": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["G0", "G1", "G2", "G3", "G4", "G5", "G6"]
      },
      "description": "Gates that MUST pass for changes under this framework"
    },
    "security_posture": {
      "type": "object",
      "properties": {
        "fail_closed": {
          "type": "boolean",
          "default": true,
          "description": "Whether gate failures block execution"
        },
        "isolated_execution": {
          "type": "boolean",
          "default": true,
          "description": "Whether execution requires isolated workspace"
        },
        "no_partial_writes": {
          "type": "boolean",
          "default": true,
          "description": "Whether atomic writes are required"
        }
      },
      "description": "Security requirements for this framework"
    },
    "change_control": {
      "type": "object",
      "properties": {
        "allowed_wo_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["code_change", "spec_delta", "registry_change", "dependency_add"]
          },
          "description": "Work order types permitted under this framework"
        },
        "requires_approval": {
          "type": "boolean",
          "default": true,
          "description": "Whether human approval is required"
        }
      },
      "description": "Change control rules"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^FMWK-[A-Z0-9-]+$"
      },
      "description": "Other frameworks this one depends on"
    }
  },
  "additionalProperties": false
}
