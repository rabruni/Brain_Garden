spec_id: SPEC-RUNTIME-001
title: "Agent Runtime Module"
framework_id: FMWK-100
status: draft
version: 0.1.0
plane_id: ho3
tier: T1

assets:
  - modules/agent_runtime/__init__.py
  - modules/agent_runtime/runner.py
  - modules/agent_runtime/capability.py
  - modules/agent_runtime/session.py
  - modules/agent_runtime/sandbox.py
  - modules/agent_runtime/prompt_builder.py
  - modules/agent_runtime/memory.py
  - modules/agent_runtime/ledger_writer.py
  - modules/agent_runtime/exceptions.py

interfaces:
  - name: AgentRunner
    description: Execute agent turns with capability enforcement
  - name: CapabilityEnforcer
    description: Check and enforce read/write/execute capabilities
  - name: Session
    description: Manage agent session lifecycle
  - name: TurnSandbox
    description: OS-level write isolation for turns
  - name: LedgerWriter
    description: Write to both L-EXEC and L-EVIDENCE

invariants:
  - "declared_outputs is the ONLY write surface"
  - "Both L-EXEC and L-EVIDENCE MUST be written per turn"
  - "Evidence MUST include session_id, turn_number, work_order_id"
  - "CapabilityViolation MUST be raised on forbidden operations"
  - "Turns MUST execute in session-scoped sandbox"

acceptance:
  tests:
    - "pytest tests/test_agent_runtime.py tests/test_sandbox_failclosed.py -v"
  checks:
    - "python3 -c 'from modules.agent_runtime import AgentRunner, Session'"

non_goals:
  - "This spec does NOT implement specific agents"
  - "This spec does NOT handle LLM API calls"
  - "This spec does NOT manage work order approval"

dependencies:
  - PKG-T0-EVIDENCE-001
  - PKG-KERNEL-001
