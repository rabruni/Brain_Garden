{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://control-plane.local/schemas/flow_runner_config.schema.json",
  "title": "Flow Runner Configuration v1.0",
  "description": "Configuration for the flow runner (agent orchestrator). All timeouts, budgets, and limits are config-driven â€” never hardcoded.",
  "type": "object",
  "properties": {
    "default_budget": {
      "type": "object",
      "properties": {
        "token_limit": {
          "type": "integer",
          "minimum": 1,
          "default": 10000,
          "description": "Default max tokens when WO doesn't specify a budget"
        },
        "turn_limit": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Default max LLM round-trips (v1: always 1)"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 1,
          "default": 120,
          "description": "Default wall-clock timeout per WO execution"
        }
      },
      "additionalProperties": false,
      "description": "Default budget applied when WO has no budget field"
    },
    "agent_id_prefix": {
      "type": "string",
      "default": "AGT",
      "description": "Prefix for generated agent instance IDs (format: {prefix}-{framework_id}-{wo_id}-{timestamp})"
    },
    "max_concurrent_flows": {
      "type": "integer",
      "minimum": 1,
      "default": 1,
      "description": "Maximum concurrent flow executions (v1: always 1)"
    },
    "execution_timeout_seconds": {
      "type": "integer",
      "minimum": 1,
      "default": 300,
      "description": "Global timeout for any single flow execution. Overrides WO budget.timeout_seconds if lower."
    },
    "framework_resolution": {
      "type": "object",
      "properties": {
        "registry_path": {
          "type": "string",
          "default": "HOT/registries/frameworks_registry.csv",
          "description": "Relative path (from plane root) to the frameworks registry CSV"
        },
        "manifest_filename": {
          "type": "string",
          "default": "manifest.yaml",
          "description": "Filename to look for inside framework directories"
        }
      },
      "additionalProperties": false,
      "description": "Settings for framework lookup and manifest resolution"
    },
    "acceptance": {
      "type": "object",
      "properties": {
        "command_timeout_seconds": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "Timeout for each acceptance test/check command"
        },
        "max_commands": {
          "type": "integer",
          "minimum": 0,
          "default": 10,
          "description": "Maximum acceptance commands per WO (prevent runaway test suites)"
        }
      },
      "additionalProperties": false,
      "description": "Settings for acceptance criteria validation (Step 7)"
    },
    "ledger": {
      "type": "object",
      "properties": {
        "event_prefix": {
          "type": "string",
          "default": "WO",
          "description": "Prefix for flow runner ledger event types (WO_STARTED, WO_EXEC_COMPLETE, etc.)"
        }
      },
      "additionalProperties": false,
      "description": "Ledger integration settings"
    },
    "v2_features": {
      "type": "object",
      "properties": {
        "multi_step_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable multi-step execution via StepStrategy (v2)"
        },
        "aperture_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable aperture model (OPEN/CLOSING/CLOSED) (v2)"
        },
        "delegation_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable HO2->HO1 delegation via DelegationManager (v2)"
        },
        "recovery_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable partial work recovery via RecoveryStrategy (v2)"
        }
      },
      "additionalProperties": false,
      "description": "v2 feature flags (all false in v1)"
    }
  },
  "additionalProperties": true
}
