{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://control-plane.local/schemas/cognitive_work_order.schema.json",
  "title": "Cognitive Work Order Schema",
  "description": "Schema for cognitive dispatch WOs -- HO2 creates, HO1 executes. Separate from governance work_order.schema.json.",
  "type": "object",
  "required": ["wo_id", "session_id", "wo_type", "tier_target", "state", "created_at", "created_by"],
  "properties": {
    "wo_id": {
      "type": "string",
      "pattern": "^WO-SES-[A-Z0-9]{8}-\\d{3}$",
      "description": "Unique WO identifier: WO-{session_id}-{seq:03d}"
    },
    "session_id": {
      "type": "string",
      "pattern": "^SES-[A-Z0-9]{8}$",
      "description": "Session this WO belongs to"
    },
    "wo_type": {
      "type": "string",
      "enum": ["classify", "tool_call", "synthesize", "execute"],
      "description": "Cognitive dispatch WO type"
    },
    "tier_target": {
      "type": "string",
      "enum": ["HO1"],
      "description": "Target tier for execution (always HO1 for now)"
    },
    "state": {
      "type": "string",
      "enum": ["planned", "dispatched", "executing", "completed", "failed"],
      "description": "Current lifecycle state"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 UTC creation timestamp"
    },
    "created_by": {
      "type": "string",
      "description": "Agent ID of the creator (HO2 cognitive process)"
    },
    "parent_wo_id": {
      "type": ["string", "null"],
      "description": "Parent WO ID for chained dispatch"
    },
    "input_context": {
      "type": "object",
      "properties": {
        "user_input": { "type": "string" },
        "prior_results": {
          "type": "array",
          "items": { "type": "object" }
        },
        "assembled_context": { "type": "object" }
      },
      "additionalProperties": true,
      "description": "Input data for the WO"
    },
    "constraints": {
      "type": "object",
      "properties": {
        "prompt_contract_id": {
          "type": "string",
          "description": "Required for LLM-calling types (classify, synthesize, execute)"
        },
        "token_budget": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum token budget for this WO"
        },
        "turn_limit": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum LLM round-trips"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 1,
          "description": "Wall-clock timeout"
        },
        "tools_allowed": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Tools the HO1 executor may invoke"
        }
      },
      "additionalProperties": true,
      "description": "Execution constraints"
    },
    "acceptance_criteria": {
      "type": "object",
      "additionalProperties": true,
      "description": "Criteria for HO2 verification (Step 4)"
    },
    "output_result": {
      "type": ["object", "null"],
      "additionalProperties": true,
      "description": "Result produced by HO1 execution"
    },
    "error": {
      "type": ["string", "null"],
      "description": "Error message if WO failed"
    },
    "completed_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "ISO8601 UTC completion timestamp"
    },
    "cost": {
      "type": "object",
      "properties": {
        "input_tokens": { "type": "integer", "minimum": 0 },
        "output_tokens": { "type": "integer", "minimum": 0 },
        "total_tokens": { "type": "integer", "minimum": 0 },
        "llm_calls": { "type": "integer", "minimum": 0 },
        "tool_calls": { "type": "integer", "minimum": 0 },
        "elapsed_ms": { "type": "integer", "minimum": 0 }
      },
      "description": "Cost tracking"
    }
  },
  "additionalProperties": true
}
